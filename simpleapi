#!/bin/bash

outstart="<simpleapi>"
outend="</simpleapi>"
case "$1" in
    clusterinfo)
        echo $outstart
        echo "<clusterinfo>"
        echo "<maxnodes>348</maxnodes>"
        echo "<maxcpus>8</maxcpus>"
        echo "<partitions>"
        for partition in "core" "node" "devel"; do
            echo "<partition>$partition</partition>"
        done;
        echo "</partitions>"
        echo "</clusterinfo>"
        echo $outend
        ;;
    projinfo)
        echo $outstart
        echo "<projinfo>"
        echo "Projinfo output here ..."
        echo "</projinfo>"
        echo $outend
        ;;
    jobinfo)
        echo $outstart
        echo "<jovinfo>"
        echo "Jobinfo output here ..."
        echo "</jobinfo>"
        echo $outend
        ;;
    userinfo)
        echo $outstart
        echo "<userinfo>"
        echo "<username>$(whoami)</username>"
        echo "<projects>"
        for proj in $(groups|tr " " "\n"|grep -P "^([abgps][0-9]|staff)"); do
            echo "<project>$proj</project>"
        done;
        echo "</userinfo>"
        echo "</projects>"
        echo $outend
        ;;
    *)
       echo $"Usage: $0 {clusterinfo|projinfo|jobinfo|userinfo}"
       exit 1
esac
